<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>궁남지 생태지도</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css"/>
  <style>
    html, body { height:100%; margin:0; }
    body { font-family:system-ui, sans-serif; }
    #map { width:100%; height:100%; }
    #app { display:grid; grid-template-columns:300px 1fr; height:100%; }
    aside { border-right:1px solid #ddd; padding:12px; overflow:auto; background:#333; }
    .brand { font-weight:700; font-size:18px; margin-bottom:8px; color:#fff; }
    .legend { display:flex; align-items:center; gap:6px; margin:4px 0; }
    /* 사이드패널(어두운 배경)에서는 흰 글자 */
    aside .legend { color:#fff; }
    /* 모바일 시트(흰 배경)에서는 어두운 글자 */
    #sheet .legend { color:#111; }  /* 혹은 #222 / #333 취향대로 */
    .chip { width:14px; height:14px; border-radius:4px; }
    .chip.birds{background:#2563eb;} .chip.plants{background:#059669;} .chip.insects{background:#d97706;}
    .panel{ background:#444; border:1px solid #555; border-radius:8px; padding:8px; margin:8px 0; color:#fff; }
    .fab{ position:fixed; right:12px; bottom:12px; z-index:1000; padding:8px 14px; border-radius:999px; background:#fff; border:1px solid #ddd; box-shadow:0 2px 8px #0002; }
    #sheet{ position:fixed; left:0; right:0; bottom:0; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; transform:translateY(100%); transition:.3s; z-index:999; max-height:70%; overflow:auto; }
    #sheet.open{ transform:translateY(0); }
    #grab{ width:40px; height:4px; background:#ccc; border-radius:2px; margin:10px auto; }
    @media(max-width:880px){ #app{ grid-template-columns:1fr; } aside{display:none;} .fab{display:block;} } 
    @media(min-width:881px){ .fab,#sheet{display:none;} }
     /* 아이콘 스타일 */
    .eco-badge{
      width:16px;
      height:16px;
      border-radius:4px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      line-height:1;
      background:#2563eb;
      color:#fff;
      border:1px solid #fff;
    }
    .eco-badge.plants{background:#059669}
    .eco-badge.insects{background:#d97706}
  </style>
</head>
<body>
<div id="app">
  <aside>
    <div class="brand">궁남지 생태지도</div>
    <div class="panel">
      <strong>레이어</strong><br>
      <label><input type="checkbox" id="birdsToggle" checked> 그 외</label><br>
      <label><input type="checkbox" id="plantsToggle" checked> 식물</label><br>
      <label><input type="checkbox" id="insectsToggle" checked> 곤충</label><br>
      <label><input type="checkbox" id="heatToggle"> 히트맵</label>
    </div>
    <div class="panel">
      <strong>범례</strong>
      <div class="legend"><span class="chip birds"></span>그 외</div>
      <div class="legend"><span class="chip plants"></span>식물</div>
      <div class="legend"><span class="chip insects"></span>곤충</div>
    </div>
  </aside>
  <main><div id="map"></div></main>
</div>
<button class="fab" id="openSheet">레이어</button>
<div id="sheet"><div id="grab"></div>
  <div style="padding:10px 16px">
    <strong>레이어</strong><br>
    <label><input type="checkbox" id="mb_birds" checked> 그 외</label><br>
    <label><input type="checkbox" id="mb_plants" checked> 식물</label><br>
    <label><input type="checkbox" id="mb_insects" checked> 곤충</label><br>
    <label><input type="checkbox" id="mb_heat"> 히트맵</label>
    <hr>
    <strong>범례</strong>
    <div class="legend"><span class="chip birds"></span>그 외</div>
    <div class="legend"><span class="chip plants"></span>식물</div>
    <div class="legend"><span class="chip insects"></span>곤충</div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
<script>
// 0) 지도 & 베이스레이어
const map = L.map('map').setView([36.269681,126.912143],16);
const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'&copy; OpenStreetMap'}).addTo(map);
const esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{maxZoom:19, attribution:'Tiles &copy; Esri'});
L.control.layers({"일반(OSM, 기본)":osm,"위성(Esri)":esriSat},{},{collapsed:true}).addTo(map);

// 1) 흰색 배경 마스크 (반경 340m 원 내부만 보이게)
map.createPane('maskPane');
map.getPane('maskPane').style.zIndex = 650; // 타일/벡터 위에 덮음
map.getPane('maskPane').style.pointerEvents = 'none';
function toRad(d){return d*Math.PI/180;} function toDeg(r){return r*180/Math.PI;}
function circleCoords(lat,lng,r,steps=128){const R=6371000,d=r/R,lat1=toRad(lat),lon1=toRad(lng);const coords=[];for(let i=0;i<steps;i++){const brng=toRad(i/steps*360);const lat2=Math.asin(Math.sin(lat1)*Math.cos(d)+Math.cos(lat1)*Math.sin(d)*Math.cos(brng));const lon2=lon1+Math.atan2(Math.sin(brng)*Math.sin(d)*Math.cos(lat1),Math.cos(d)-Math.sin(lat1)*Math.sin(lat2));coords.push([toDeg(lat2),toDeg(lon2)]);}return coords;}
const focus={lat:36.269681,lng:126.912143,radiusM:340};
const ringCoords = circleCoords(focus.lat, focus.lng, focus.radiusM, 128);
const world=[[-89.9,-179.9],[-89.9,179.9],[89.9,179.9],[89.9,-179.9]];
L.polygon([world, ringCoords.slice().reverse()], {pane:'maskPane', stroke:false, fillColor:'#fff', fillOpacity:1}).addTo(map);
L.polygon(ringCoords,{color:'#10b981',weight:2,dashArray:'5,5',fill:false}).addTo(map);

// 2) 아이콘/그룹
const makeIcon=(cls,emoji)=> L.divIcon({
  className:'eco-icon',
  html:`<div class="eco-badge ${cls}">${emoji}</div>`,
  iconSize:[16,16],
  iconAnchor:[8,8]
});
const icons={
  birds: makeIcon('', '🕊️'),
  plants: makeIcon('plants', '🌿'),
  insects: makeIcon('insects', '🐛')
};
const groups={birds:L.layerGroup().addTo(map),plants:L.layerGroup().addTo(map),insects:L.layerGroup().addTo(map)};

// 3) 데이터 (샘플 + 사용자 요청 네발나비)
const points=[
 {cat:'birds',name:'참개구리 (<i>Pelophylax nigromaculatus</i>)',lat:36.269611,lon:126.911023,
  desc: '초록 등과 검은 반점, 길게 울어대는 ‘꿀—’ 소리가 두드러진다.',
  img:'./Images/b1.jpg' },
 {cat:'birds',name:'중백로 (<i>Ardea intermedia</i>)',lat:36.270368,lon:126.911524,
  desc: '전신이 흰색이며 부리가 길고 곧아 물고기를 재빠르게 낚는다.',
  img:'./Images/b2.jpg' },
 {cat:'birds',name:'왜가리 (<i>Ardea cinerea</i>)',lat:36.268943,lon:126.913767,
  desc: '회색 몸과 검은 눈썹선이 뚜렷하고, 긴 다리로 얕은 물가에서 느리게 사냥한다.',
  img:'./Images/b3.jpg' },
 {cat:'birds',name:'까치 (<i>Pica serica</i>)',lat:36.268094,lon:126.912281,
  desc: '검은·흰 깃의 대비와 긴 꼬리가 특징이며, 지능이 높고 소리가 다양하다.',
  img:'./Images/b4.jpg'},
 {cat:'birds',name:'흰뺨검둥오리 (<i>Anas zonorhyncha</i>)',lat:36.269638,lon:126.910922,
  desc: '갈색 몸통에 부리 끝 노란 테와 흰뺨이 특징인 민물오리다.',
  img:'./Images/b5.jpg'},
 {cat:'birds',name:'잉어 (<i>Cyprinus rubrofuscus</i>)',lat:36.269300,lon:126.912206,
  desc: '오래 사는 대표적 담수어로 크기가 크고 환경 적응력이 뛰어나다.',
  img:'./Images/b6.jpg'},
  {cat:'birds',name:'노랑망태버섯 (<i>Phallus luteus</i>)',lat:36.269406,lon:126.910571,
  desc: '노란 갓 아래 망사 같은 ‘치마’를 드리우고 악취로 파리를 유인한다.',
  img:'./Images/b7.jpg'},

 {cat:'plants',name:'개구리밥 (<i>Spirodela polyrhiza</i>)',lat:36.271941,lon:126.911332,
  desc: '동전보다 작은 둥근 잎이 수면을 촘촘히 덮고, 밑면에 짧은 뿌리가 달린다.',
  img:'./Images/p1.jpg'},
  {cat:'plants',name:'고마리 (<i>Persicaria thunbergii</i>)',lat:36.271469,lon:126.910924,
  desc: '습지에 자라는 1년생 초본으로 붉은 자주색 작은 꽃이 이삭 모양으로 핀다.',
  img:'./Images/p2.jpg'},
  {cat:'plants',name:'국화 (<i>Chrysanthemum × morifolium</i>)',lat:36.272097,lon:126.911779,
  desc: '혀꽃과 관꽃이 촘촘히 모여 향기가 강하고, 품종에 따라 꽃모양이 매우 다양하다.',
  img:'./Images/p3.jpg'},
  {cat:'plants',name:'긴흑삼릉 (<i>Sparganium japonicum</i>)',lat:36.268665,lon:126.914455,
  desc: '물가나 얕은 물에 서식하며 검은 공 모양의 꽃차례가 달리는 수생식물이다.',
  img:'./Images/p4.jpg'},
  {cat:'plants',name:'꽃무릇 (<i>Lycoris radiata</i>)',lat:36.270689,lon:126.912510,
  desc: '잎 없이 꽃대만 올라와 붉은 꽃을 피우고, 잎은 꽃 진 뒤 따로 난다.',
  img:'./Images/p5.jpg'},
  {cat:'plants',name:'나무수국 (<i>Hydrangea paniculata</i>)',lat:36.270966,lon:126.912544,
  desc: '원추형 큰 꽃차례가 흰색에서 연분홍으로 변색하며 가지가 곧게 선다.',
  img:'./Images/p6.jpg'},
  {cat:'plants',name:'노랑어리연꽃 (<i>Nymphoides peltata</i>)',lat:36.269009,lon:126.910765,
  desc: '둥근 뜰잎과 별 모양의 노란 꽃이 물가를 장식한다.',
  img:'./Images/p7.jpg'},
  {cat:'plants',name:'능소화 (<i>Campsis grandiflora</i>)',lat:36.271708,lon:126.911249,
  desc: '주황색 나팔 모양 꽃이 덩굴 끝에서 다발로 피고, 긴 꼬투리 열매를 맺는다.',
  img:'./Images/p8.jpg'},
  {cat:'plants',name:'단풍잎부용 (<i>Hibiscus coccineus</i>)',lat:36.269722,lon:126.911062,
  desc: '단풍처럼 갈라진 잎과 큰 분홍색 꽃이 특징인 관상용 아욱과 식물이다.',
  img:'./Images/p9.jpg'},
  {cat:'plants',name:'닭의장풀 (<i>Commelina communis</i>)',lat:36.271147,lon:126.910546,
  desc: '맑은 파란 꽃이 아침에 피고 낮에 시들며, 잎자루가 길고 즙이 많다.',
  img:'./Images/p10.jpg'},
  {cat:'plants',name:'데이지 (<i>Bellis perennis</i>)',lat:36.272158,lon:126.911332,
  desc: '낮은 로제트에서 꽃대가 올라와 흰 혀꽃과 노란 관상화가 선명하다.',
  img:'./Images/p11.jpg'},
  {cat:'plants',name:'며느리배꼽 (<i>Persicaria perfoliata</i>)',lat:36.268911,lon:126.912958,
  desc: '줄기에 뒤꿰는 모양의 잎과 뒤로 휘는 갈고리 가시로 다른 식물에 잘 달라붙는다.',
  img:'./Images/p12.jpg'},
  {cat:'plants',name:'무궁화 (<i>Hibiscus syriacus</i>)',lat:36.269310,lon:126.914209,
  desc: '큰 깔때기 모양 꽃이 연속적으로 피고, 화심의 수술기둥이 한눈에 띈다.',
  img:'./Images/p13.jpg'},
  {cat:'plants',name:'물수세미 (<i>Myriophyllum verticillatum</i>)',lat:36.268614,lon:126.912330,
  desc: '잠긴 잎이 실처럼 잘게 갈라져 물속에서 부드러운 숲을 이룬다.',
  img:'./Images/p14.jpg'},
  {cat:'plants',name:'물양귀비 (<i>Hydrocleys nymphoides</i>)',lat:36.268652,lon:126.913614,
  desc: '물 위에 뜨는 타원 잎과 밝은 노란 꽃이 피는 관상 수생식물이다.',
  img:'./Images/p15.jpg'},
  {cat:'plants',name:'물옥잠 (<i>Monochoria korsakowii</i>)',lat:36.271383,lon:126.911545,
  desc: '도톰한 잎과 선명한 보라빛 꽃이 달리고, 논·연못 가장자리에서 잘 자란다.',
  img:'./Images/p16.jpg'},
  {cat:'plants',name:'물칸나 (<i>Thalia dealbata</i>)',lat:36.270908,lon:126.912103,
  desc: '키가 크고 잎에 흰 분가루가 끼며, 높게 솟은 꽃대에 보랏빛 꽃이 피어난다.',
  img:'./Images/p17.jpg'},
  {cat:'plants',name:'토란 (<i>Colocasia esculenta</i>)',lat:36.270897,lon:126.911818,
  desc: '큰 방패형 잎이 물방울을 또르르 굴리고, 줄기와 괴경에 전분이 많다.',
  img:'./Images/p18.jpg'},
  {cat:'plants',name:'미국부용 (<i>Hibiscus palustris</i>)',lat:36.269967,lon:126.911223,
  desc: '접시만 한 큰 꽃이 분홍·흰색으로 피고, 잎은 넓고 거칠다.',
  img:'./Images/p19.jpg'},
  {cat:'plants',name:'민들레 (<i>Taraxacum platycarpum</i>)',lat:36.269493,lon:126.913413,
  desc: '노란 꽃이 한 송이씩 피고, 씨앗은 하얀 홀씨로 멀리 날아간다.',
  img:'./Images/p20.jpg'},
  {cat:'plants',name:'어트랙션 ("<i>Nymphaea</i>'attration'"")',lat:36.271320,lon:126.912902,
  desc: '둥근 뜰잎이 물에 떠 있고, 꽃은 낮에 열고 저녁에 감는다.',
  img:'./Images/p21.jpg'},
  {cat:'plants',name:'버드나무 (<i>Salix koreensis</i>)',lat:36.270376,lon:126.912625,
  desc: '가지가 유연하고 일찍 꽃가루를 날리며, 솜털 씨앗이 대량으로 퍼진다.',
  img:'./Images/p22.jpg'},
  {cat:'plants',name:'병꽃나무 (<i>Weigela subsessilis</i>)',lat:36.268753,lon:126.911306,
  desc: '연한 황록색으로 폈다가 분홍으로 변하는 통꽃이 가지에 다닥이 달린다.',
  img:'./Images/p23.jpg'},
  {cat:'plants',name:'병꽃풀 (<i>Glechoma hederacea</i>)',lat:36.268940,lon:126.913225,
  desc: '땅을 기어 퍼지며 잎에서 향이 나고, 자주빛 입술꽃이 핀다.',
  img:'./Images/p24.jpg'},
  {cat:'plants',name:'부들 (<i>Typha orientalis</i>)',lat:36.270851,lon:126.910745,
  desc: '원기둥 모양의 갈색 꽃이삭이 인상적이며, 줄기는 속이 스펀지처럼 부드럽다.',
  img:'./Images/p25.jpg'},
  {cat:'plants',name:'부레옥잠 (<i>Eichhornia crassipes</i>)',lat:36.269543,lon:126.911337,
  desc: '통통한 부레줄기로 물에 뜨며, 라벤더빛 꽃이 짧게 올라온다.',
  img:'./Images/p26.jpg'},
  {cat:'plants',name:'부용 (<i>Hibiscus mutabilis</i>)',lat:36.268726,lon:126.912773,
  desc: '아침엔 흰색으로 피고 시간이 지나며 분홍에서 진분홍으로 색이 변한다.',
  img:'./Images/p27.jpg'},
  {cat:'plants',name:'비비추 (<i>Hosta longipes</i>)',lat:36.270066,lon:126.912822,
  desc: '넓은 잎맥이 선명한 그늘식물로, 보랏빛 나팔 같은 꽃이 늘어진 꽃대에 핀다.',
  img:'./Images/p28.jpg'},
  {cat:'plants',name:'사철나무 (<i>Euonymus japonicus</i>)',lat:36.268713,lon:126.912462,
  desc: '광택 있는 두꺼운 잎을 사철 유지하고, 가을에 주황색 가종피가 열린다.',
  img:'./Images/p29.jpg'},
  {cat:'plants',name:'산국 (<i>Chrysanthemum boreale</i>)',lat:36.271854,lon:126.911780,
  desc: '노란 작은 꽃이 산들바람에 흔들리며 강한 국화 향을 낸다.',
  img:'./Images/p30.jpg'},
  {cat:'plants',name:'생이가래 (<i>Salvinia natans</i>)',lat:36.270312,lon:126.910997,
  desc: '물 위에 뜨는 잎이 비늘처럼 겹쳐지고, 표면에 미세한 털이 난다.',
  img:'./Images/p31.jpg'},
  {cat:'plants',name:'선파이어 ("<i>Nymphaea</i> 'sunfire'")',lat:36.270183,lon:126.911307,
  desc: '황·주황 계열의 선명한 꽃색과 컴팩트한 생육이 관상가치가 높다.',
  img:'./Images/p32.jpg'},
  {cat:'plants',name:'소나무 (<i>Pinus densiflora</i>)',lat:36.270869,lon:126.910478,
  desc: '붉은빛 수피가 벗겨지며, 두 개씩 붙은 솔잎과 길쭉한 솔방울이 특징이다.',
  img:'./Images/p33.jpg'},
  {cat:'plants',name:'쇠뜨기 (<i>Equisetum arvense</i>)',lat:36.269098,lon:126.911080,
  desc: '마디가 뚜렷한 속 빈 줄기에 규질이 많아 거칠고, 포자줄기와 녹색줄기가 따로 난다.',
  img:'./Images/p34.jpg'},
  {cat:'plants',name:'수국 (<i>Hydrangea macrophylla</i>)',lat:36.269776,lon:126.913145,
  desc: '둥근 공 모양 꽃차례가 토양 산도에 따라 청·분홍으로 변한다.',
  img:'./Images/p35.jpg'},
  {cat:'plants',name:'시페루스 (<i>Cyperus alternifolius</i>)',lat:36.270328,lon:126.910953,
  desc: '곧은 줄기 끝에서 잎이 우산살처럼 사방으로 퍼진다.',
  img:'./Images/p36.jpg'},
  {cat:'plants',name:'연꽃 (<i>Nelumbo nucifera</i>)',lat:36.268319,lon:126.911090,
  desc: '여름에 큰 분홍·흰 꽃을 피우며 씨와 뿌리줄기가 식용·약용으로 이용된다.',
  img:'./Images/p37.jpg'},
  {cat:'plants',name:'영산홍 (<i>Rhododendron indicum</i>)',lat:36.269872,lon:126.913218,
  desc: '키 낮은 상록성 진달래류로 붉은 깔때기꽃이 가지 끝에 군생한다.',
  img:'./Images/p38.jpg'},
  {cat:'plants',name:'왕질경이 (<i>Plantago major</i>)',lat:36.268439,lon:126.913021,
  desc: '큰 타원형 로제트 잎과 곧게 솟는 길쭉한 꽃이삭이 특징이다.',
  img:'./Images/p39.jpg'},
  {cat:'plants',name:'원추리 (<i>Hemerocallis fulva</i>)',lat:36.269866,lon:126.911010,
  desc: '하루 만에 피고 지는 주황색 꽃이 특징으로 관상용과 식용으로 쓰인다.',
  img:'./Images/p40.jpg'},
  {cat:'plants',name:'은행나무 (<i>Ginkgo biloba</i>)',lat:36.268588,lon:126.910425,
  desc: '부채 모양 잎맥이 방사상으로 퍼지고, 암그루 열매는 특유의 냄새가 난다.',
  img:'./Images/p41.jpg'},
  {cat:'plants',name:'이집트 남수련 (<i>Nymphaea caerulea</i>)',lat:36.270431,lon:126.911599,
  desc: '푸른빛 꽃과 가느다란 꽃잎이 우아하며, 잎은 얇고 둥글다.',
  img:'./Images/p42.jpg'},
  {cat:'plants',name:'인도칸나 (<i>Canna indica</i>)',lat:36.271252,lon:126.911983,
  desc: '열대성 초본으로 화려한 붉은·주황 꽃과 넓은 잎이 특징이며 관상 가치가 높다.',
  img:'./Images/p43.jpg'},
  {cat:'plants',name:'자이언트 파피루스 (<i>Cyperus papyrus</i>)',lat:36.270370,lon:126.910514,
  desc: '긴 줄기 끝에 우산살처럼 잎이 총상으로 퍼져 이국적인 실루엣을 만든다.',
  img:'./Images/p44.jpg'},
  {cat:'plants',name:'좀개구리밥 (<i>Lemna perpusilla</i>)',lat:36.269974,lon:126.910810,
  desc: '아주 작은 타원 잎이 몇 개씩 모여 떠다니고, 뿌리는 한 가닥이다.',
  img:'./Images/p45.jpg'},
  {cat:'plants',name:'쥐꼬리망초 (<i>Justicia procumbens</i>)',lat:36.268430,lon:126.912639,
  desc: '낮게 퍼지며 연보랏빛 작은 꽃이 잎겨드랑이에 드문드문 달린다.',
  img:'./Images/p46.jpg'},
  {cat:'plants',name:'질경이 (<i>Plantago asiatica</i>)',lat:36.271560,lon:126.911101,
  desc: '두꺼운 로제트 잎에 평행 맥이 도드라지고, 길쭉한 꽃대가 줄줄이 선다.',
  img:'./Images/p47.jpg'},
  {cat:'plants',name:'찔레 (<i>Rosa multiflora</i>)',lat:36.269490,lon:126.910769,
  desc: '가늘고 구부러진 가시가 많고, 가을에 빨간 장과(로즈힙)가 달린다.',
  img:'./Images/p48.jpg'},
  {cat:'plants',name:'철쭉 (<i>Rhododendron schlippenbachii</i>)',lat:36.269969,lon:126.913565,
  desc: '넓은 연분홍 꽃이 한꺼번에 피고, 가지는 성기지만 꽃량이 풍성하다.',
  img:'./Images/p49.jpg'},
  {cat:'plants',name:'큰가시연꽃 (<i>Victoria amazonica</i>)',lat:36.270527,lon:126.913120,
  desc: '접시처럼 큰 원형 잎이 가장자리가 치켜올라가고, 매우 가끔 밤에 향기로운 꽃이 핀다.',
  img:'./Images/p50.jpg'},
  {cat:'plants',name:'큰땅빈대 (<i>Euphorbia nutans</i>)',lat:36.270578,lon:126.910581,
  desc: '줄기·잎을 상처내면 흰 유액이 나오고, 작고 눈에 띄지 않는 꽃이 싹군다.',
  img:'./Images/p51.jpg'},

 {cat:'insects',name:'네발나비 (<i>Polygonia c-aureum</i>)', lat:36.269439, lon:126.9137465,
  desc:'톱니처럼 찢긴 주황빛 날개와 뒷날개 ‘C’ 표식이 특징이다.',
  img:'./Images/bf.jpg'},
  {cat:'insects',name:'남방부전나비 (<i>Pseudozizeeria maha</i>)', lat:36.2691517, lon:126.9136577,
  desc:'작은 체구에 수컷은 은청색 광택, 암컷은 회갈색에 얼룩이 있다.',
  img:'./Images/bf2.jpg'},
  {cat:'insects',name:'소금쟁이 (<i>Aquarius paludum paludum</i>)', lat:36.270137, lon:126.911417,
  desc:'궁남지 전반에 퍼져 있다. 발끝의 미세한 털로 수면 장력을 이용해 물 위를 미끄러지듯 걷는다.',
  img:'./Images/bf3.jpg'},
  {cat:'insects',name:'고추잠자리 (<i>Crocothemis servilia</i>)', lat:36.271536, lon:126.912707,
  desc:'수컷은 선명한 붉은색이고, 물가를 낮게 활주하듯 비행한다.',
  img:'./Images/bf4.jpg'},
  {cat:'insects',name:'밀잠자리 (<i>Orthetrum albistylum</i>)', lat:36.269494, lon:126.913981,
  desc:'수컷 가슴·배에 회백색 분가루가 끼고, 날개맥이 굵어 보인다.',
  img:'./Images/bf5.jpg'},
  {cat:'insects',name:'미국흰불나방유충 (<i>Hyphantria cunea</i>)', lat:36.268881, lon:126.912588,
  desc:'궁남지 전반에 퍼져 있다. 가지에 흰 거미줄집을 만들고 떼로 잎을 갉아먹는 해충이다.',
  img:'./Images/bf6.jpg'},
  {cat:'insects',name:'먼지벌레 (<i>Anisodactylus signatus</i>)', lat:36.270522, lon:126.910626,
  desc:'검은 금속광택의 땅딱정벌레로, 밤에 활동하며 작은 절지동물을 포식한다.',
  img:'./Images/bf7.jpg'},
  {cat:'insects',name:'암끝검은표범나비 (<i>Argyreus hyperbius</i>)', lat:36.269471, lon:126.913857,
  desc:'큰 주황색 날개에 검은 반점이 있고, 암컷은 뒷날개 끝부분이 어둡다.',
  img:'./Images/bf8.jpg'},
  {cat:'insects',name:'재래꿀벌 (<i>Apis cerana</i>)', lat:36.269270, lon:126.910775,
  desc:'몸집이 작고 민첩하며, 온도 변화와 밀원 변화에 민감해 집단 행동이 빠르다.',
  img:'./Images/bf9.jpg'},
  {cat:'insects',name:'팥중이 (<i>Oedaleus infernalis</i>)', lat:36.270485, lon:126.910806,
  desc:'초지에서 잘 날아오르는 초록색형보다 갈색형이 흔한 메뚜기로, 등의 X자가 선명하다.',
  img:'./Images/bf10.jpg'},
  {cat:'insects',name:'배추흰나비 (<i>Pieris rapae</i>)', lat:36.269018, lon:126.913336,
  desc:'흰 날개에 검은점이 있으며, 애벌레는 배추과 잎을 선호한다.',
  img:'./Images/bf11.jpg'},
  {cat:'insects',name:'아시아실잠자리 (<i>Ischnura asiatica</i>)', lat:36.269140, lon:126.911175,
  desc:'가늘고 작은 체형에 수컷 꼬리마디가 파랗게 빛난다.',
  img:'./Images/bf12.jpg'},
];

points.forEach(p=>{
  const descHtml = p.desc?`<div style="margin:6px 0;color:#374151">${p.desc}</div>`:'';
  const imgHtml = p.img?`<img src="${p.img}" alt="${p.name}" style="width:100%;height:auto;border-radius:8px">`:'';
  const html = `<div style="min-width:220px;max-width:280px;line-height:1.35">
    <div style="font-weight:700;margin-bottom:4px">${p.name||''}</div>
    ${descHtml}${imgHtml}
  </div>`;
  const icon = icons[p.cat] || icons.plants;
  L.marker([p.lat,p.lon],{icon}).bindPopup(html).addTo(groups[p.cat]);
});

// 4) 히트맵
const heat = L.heatLayer(points.map(p=>[p.lat,p.lon, (p.cat==='birds'?0.6:(p.cat==='insects'?0.8:0.5)) ]),{radius:25,blur:15});

// 5) 토글 바인딩 (데스크톱/모바일)
function bind(id,key){ const el=document.getElementById(id); if(!el) return; el.addEventListener('change',e=>{ e.target.checked?groups[key].addTo(map):map.removeLayer(groups[key]); }); }
bind('birdsToggle','birds'); bind('plantsToggle','plants'); bind('insectsToggle','insects');
const ht=document.getElementById('heatToggle'); if(ht){ ht.addEventListener('change',e=>{ e.target.checked?heat.addTo(map):map.removeLayer(heat); }); }
const sheet=document.getElementById('sheet'); document.getElementById('openSheet').onclick=()=>sheet.classList.add('open'); document.getElementById('grab').onclick=()=>sheet.classList.remove('open');
bind('mb_birds','birds'); bind('mb_plants','plants'); bind('mb_insects','insects');
const mbht=document.getElementById('mb_heat'); if(mbht){ mbht.addEventListener('change',e=>{ e.target.checked?heat.addTo(map):map.removeLayer(heat); }); }
</script>
</body>
</html>
